# Project    : ipv6calc/ipv6calc
# File       : Makefile[.in]
# Version    : $Id: Makefile.in,v 1.21 2006/10/28 09:29:30 peter Exp $
# Copyright  : 2002-2006 by Peter Bieringer <pb (at) bieringer.de>
#
# Information:
#  Makefile for ipv6calc
#

prefix		= @prefix@
exec_prefix	= @exec_prefix@

# Compiler and Linker Options
COPTS = -O2 -Wall -g

CFLAGS	= $(COPTS) @GETOPT_INCLUDE@ -I../ -I../lib/

GETOBJS = @LIBOBJS@ ../md5/md5.o

ifeq (@ENABLE_SUPPORT_IP2LOCATION@, 1)
  COPTS := $(COPTS) -DSUPPORT_IP2LOCATION
  path_libIP2Location = ../databases/IP2Location/C-IP2Location-@VERSION_IP2LOCATION@/libIP2Location
  CFLAGS := $(CFLAGS) -I$(path_libIP2Location)
  GETOBJS := $(GETOBJS) $(path_libIP2Location)/IP2Location.o $(path_libIP2Location)/bigdigits.o $(path_libIP2Location)/spBigdigits.o $(path_libIP2Location)/bigd.o
endif

ifeq (@ENABLE_SUPPORT_GEOIP@, 1)
  COPTS := $(COPTS) -DSUPPORT_GEOIP
  ifeq (@ENABLE_SYSTEM_GEOIP@, 1)
    GETOBJS := $(GETOBJS) -lGeoIP
  else
    path_libGeoIP = ../databases/GeoIP/GeoIP-@VERSION_GEOIP@/libGeoIP
    CFLAGS := $(CFLAGS) -I$(path_libGeoIP)
    GETOBJS := $(GETOBJS) $(path_libGeoIP)/GeoIP.o $(path_libGeoIP)/GeoIPCity.o
  endif
endif

CC	= gcc

OBJS	= ipv6calc.o showinfo.o

# splint
SPLINT_OPT_OUTSIDE = -warnposix -nullassign -uniondef -compdef -usedef -formatconst -exportlocal
#SPLINT_OPT_OUTSIDE = -uniondef +matchanyintegral --nullassign +ignoresigns -compdef -usedef -modobserver -formatconst -warnposix -exportlocal
SPLINT_TODO_LATER = -unrecog  -retvalint


all:		ipv6calc

.c.o:
		$(CC) $(CFLAGS) -c $<

$(OBJS):	ipv6calc.h showinfo.h ../config.h

libipv6calc.a:	
		cd ../ && ${MAKE} lib-make

ipv6calc:	$(OBJS) libipv6calc.a ../lib/ipv6calcoptions.h
		$(CC) -o ipv6calc $(OBJS) $(GETOBJS) -lipv6calc -L../lib/ $(LDFLAGS)

static:		ipv6calc
		$(CC) -o ipv6calc-static $(OBJS) $(GETOBJS) -lipv6calc -L../lib/ -static $(LDFLAGS)

distclean:
		${MAKE} clean

autoclean:
		${MAKE} distclean

clean:
		rm -f ipv6calc ipv6calc-static *.o

test:
		${MAKE}
		./test_ipv6calc.sh || exit 1

splint:		
		splint *.c ../lib/*.c -I.. -I../lib $(SPLINT_OPT_OUTSIDE) $(SPLINT_TODO_LATER)

install:	ipv6calc
		mkdir -p $(root)@bindir@
		install -m 755 ipv6calc $(root)@bindir@

